!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("undefined"!=typeof module&&module.exports?require("jquery"):jQuery)}(function(e){function t(e,t){return function(e,t){var s=new i(e,t),r="file:"===location.protocol||0===location.host.indexOf("localhost");n[e]=s,(r||window.localStorage.getItem("formCacheIsDev"))&&(window.formCache=n);return s}(e,t)}function i(t,i){i=e.extend({stopOnError:!1,errorIcon:!1,successIcon:!1,isBlurCheck:!0,disabledClass:null,allowLost:!1,triggerDefault:null,msgBox:".j_msg",msgClass:".msg-box",errorClass:null,rules:{},fields:{},beforeValid:null,valid:null,submitBtn:null,resetBtn:null},i);var n=e(t),s=i.errorIcon,r=i.successIcon;i.errorIcon=!0===s?'<i class="msg-errorIcon"></i>':s,i.successIcon=!0===r?'<i class="msg-successIcon"></i>':r;for(var l in i)i.hasOwnProperty(l)&&(this[l]=i[l]);this.ele=n,this.checkCache={},this.init()}var n={};i.prototype={init:function(){var e,t=this.ele,i=this.fields;if(0!==t.length){for(e in i)i.hasOwnProperty(e)&&this.bindEleBlur(e);this.bindFormEvent()}},bindEleBlur:function(t){var i=this,n=i.ele,s=n.find('[name="'+t+'"]'),r=i.getFieldValue(t);i.fields[t].value=r,""!==r&&i.doTriggerDefault(t),s.is("select")||s.is(":radio")||s.is(":checkbox")?n.on("change",'[name="'+t+'"]',function(n){i.fields[t].value=i.getFieldValue(t),i.isBlurCheck&&i.checkValid(e(this),!0)}):n.on("blur",'[name="'+t+'"]',function(n){i.fields[t].value=i.getFieldValue(t),i.isBlurCheck&&i.checkValid(e(this),!0)})},getFieldValue:function(t){var i=this,n=i.ele,s=t instanceof jQuery,r=s?t:n.find(t?'[name="'+t+'"]':"[name]"),l={};return s&&(t=r.attr("name")),r.each(function(t,s){var r=e(s),a=r.attr("name"),o="";void 0===r.attr("disabled")&&void 0===r.attr("novalidate")&&(i.allowLost&&r.is(":hidden")&&(!r.is('[type="hidden"]')||r.parent().is(":hidden"))||(o=r.is('[type="radio"]')?n.find('[name="'+a+'"]').filter(":checked").val()||"":r.is('[type="checkbox"]')?r.is(":checked")?r.val():"":r.val()||"",l[a]=o))}),t?l[t]||"":l},doTriggerDefault:function(e){var t=","+this.triggerDefault+",";"string"==typeof t&&-1!==t.indexOf(","+e+",")&&this.checkValid(e,this.isBlurCheck)},bindFormEvent:function(){var t=this,i=t.ele,n=i.find(t.submitBtn||":submit"),s=i.find(t.resetBtn||":reset");0===n.length&&null!==t.submitBtn&&(n=e(t.submitBtn)),0===s.length&&null!==t.resetBtn&&(s=e(t.resetBtn)),null!==t.disabledClass&&n.addClass(t.disabledClass),i.on("reset",function(e){i.find(t.msgClass).hide(),t.checkCache={},null!==t.disabledClass&&n.addClass(t.disabledClass)}),i.on("submit",function(e){if(null!==t.valid&&e.preventDefault(),!t.clickSubmitBtn)return t.clickSubmitBtn=!0,setTimeout(function(){t.clickSubmitBtn=!1},1e3),t.submit()}),n.length&&!n.is(":submit")&&n.on("click",function(e){e.preventDefault(),i.trigger("submit")}),s.length&&!s.is(":reset")&&s.on("click",function(e){e.preventDefault(),i.trigger("reset")})},submit:function(){var e,t,i=this.ele.find(this.submitBtn||":submit");return(null===this.disabledClass||!i.hasClass(this.disabledClass))&&(e=this.checkValid(void 0,!1),"function"==typeof this.beforeValid&&!1===this.beforeValid.call(this,e)&&(e=!1),!1!==e&&("function"==typeof this.valid&&(t=this.valid.call(this,e,i)),void 0===t||!0===t))},checkValid:function(t,i){var n=this,s=n.ele,r=!0,l=!0,a={},o=t instanceof jQuery,d=o?t:void 0;return o&&(t=d.attr("name")),e.each(n.fields,function(r,u){var c,f,h,m;if(void 0===t||t===r){if(0===(c=o?d:s.find('[name="'+r+'"]')).length){if(n.allowLost)return;m=!0,c=e('<input name="'+r+'" value="">')}if(c.each(function(){var s,o=e(this);if(f=n.getFieldValue(o),void 0===o.attr("disabled")&&void 0===o.attr("novalidate")&&(!n.allowLost||!o.is(":hidden")||o.is('[type="hidden"]')&&!o.parent().is(":hidden")))return void 0===(s=n.fieldValid(r,f))&&(s=!0),n.checkCache[r]=!0===s&&f,!0!==s?(!1!==u.setMsg&&n.setMsg(o,s,i),l=!1):(a[r]=f,!1!==u.setMsg&&n.setMsg(o,"",i),void 0!==t&&void 0!==u.beMatched&&n.getFieldValue(u.beMatched)&&n.checkValid(u.beMatched,n.isBlurCheck)),!0===s&&"function"==typeof u.valid&&u.valid.call(n,f,o),!0!==s&&"function"==typeof u.invalid&&u.invalid.call(n,s,o),!0!==s&&n.stopOnError?(h=!0,!1):void 0}),m&&c.remove(),!0===h)return!1}}),null!==n.disabledClass&&(e.each(n.fields,function(e,t){if(!1===n.checkCache[e]||void 0===n.checkCache[e])return r=!1,!1}),s.find(n.submitBtn||":submit").toggleClass(n.disabledClass,!r)),!1!==l&&(void 0===t?n.getFieldValue():a)},setMsg:function(e,t,i){var n,s,r,l,a=this,o=a.ele,d=e instanceof jQuery,u=d?e:o.find('[name="'+e+'"]'),c=""===t||void 0===t||!0===t,f=!0;d&&(e=u.attr("name")),n=(a.fields[e]||{}).msgBox||u.attr("data-msgbox"),"."===e[0]||"#"===e[0]?s=o.find(e):(void 0===n?(s=o.find(a.msgBox)).length>1&&(s=u.parent().find(a.msgBox)):s=o.find(n),void 0===i&&(a.checkCache[e]=!!c&&a.getFieldValue(u)),!1===i&&!1===a.stopOnError?("string"==typeof(l=s.data("msgState"))&&l!==e&&(f=!1),c||s.data("msgState",e)):s.removeData("msgState")),f&&(r=s.data("timerSetMsg"),clearTimeout(r)),c?!1!==a.successIcon?(u.removeClass(a.errorClass),f&&(r=setTimeout(function(){s.html(a.successIcon).show()},100))):(u.removeClass(a.errorClass),f&&(r=setTimeout(function(){s.html("").hide()},100))):(u.addClass(a.errorClass),f&&(r=setTimeout(function(){s.html(!1!==a.errorIcon?a.errorIcon+t:t).show()},100))),s.data("timerSetMsg",r)},fieldValid:function(e,i){var n,s,r,l,a,o=this.fields[e].rules;for(name in o)if(Object.prototype.hasOwnProperty.call(o,name))if(n=name.replace(/\(.*\)/,""),s=o[name],(r=name.indexOf("(")>0?name.replace(n,"").replace("(","").replace(")","").split(","):[]).unshift(i),"function"==typeof s){if(!0!==(a=s.call(this,i)))return a}else if("function"==typeof(l=this.rules[n]||t.rules[n]||null)&&!1===(a=l.apply(this,r)))return s;return!0}},t.submit=function(e){var t=n[e];if(void 0!==t)return t.submit()},t.setMsg=function(e,t,i){var s=n[e];if(void 0!==s)return s.setMsg(t,i)},t.rules={ip:function(e){return/((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)/.test(e)},url:function(e){return/^(http|https):\/\/([\w-]+\.)+[\w-]+.*?$/.test(e)},date:function(e){return/^\d{4}-\d{1,2}-\d{1,2}$/.test(e)||/^\d{4}\/\d{1,2}\/\d{1,2}$/.test(e)},mobile:function(e){return/^1\d{10}$/.test(e)},phone:function(e){return/^(?:(?:0\d{2,3}[\- ]?[1-9]\d{6,7})|(?:[48]00[\- ]?[1-9]\d{6}))$/.test(e)},required:function(e){return!/^\s*$/.test(e)},IDcard:function(e){return/^\d{6}(19|2\d)?\d{2}(0[1-9]|1[012])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)?$/.test(e)},chinese:function(e){return/^[\u0391-\uFFE5]+$/.test(e)},email:function(e){return/^[\w\+\-]+(\.[\w\+\-]+)*@[a-z\d\-]+(\.[a-z\d\-]+)*\.([a-z]{2,4})$/i.test(e)},qq:function(e){return/^[1-9]\d{4,}$/.test(e)},zipcode:function(e){return/^\d{6}$/.test(e)},digits:function(e){return/^\d+$/.test(e)},letters:function(e){return/^[a-z]+$/i.test(e)},length:function(e,t,i){var n=(e+"").length;return void 0!==i?n<=i&&n>=t:n>=t},byteLength:function(e,t,i){var n=(e+"").replace(/[^\x00-\xff]/gi,"**").length;return void 0!==i?n<=i&&n>=t:n>=t},match:function(e,t){return this.getFieldValue(t)===e}},e.form=t});